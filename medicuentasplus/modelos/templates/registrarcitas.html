<!doctype html>
<html lang="en">
{% load static %}

<head>
    <title>MEDICUENTAS PLUS</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS only -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans+SC:wght@300&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!-- Material Kit CSS -->
    <link href="{% static 'css/material-dashboard.css' %}" rel="stylesheet" />
        <script type = "text/javascript" >  
            function preventBack() { window.history.forward(); }  
            setTimeout("preventBack()", 0);  
            window.onunload = function () { null };  
        </script> 
</head>

<body>
    <div class="wrapper ">
        <div class="sidebar" data-color="purple" data-background-color="white">
            <!--
      Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

      Tip 2: you can also add an image using data-image tag
  -->
            <div class="logo" style="background-color: #3c3c3c;">
                <a href="http://www.creative-tim.com" class="simple-text logo-mini">
                    <img src="{% static 'imagenes/medicuentaslogo.png'%}" style=" width: 70%; margin-bottom: 10px" />
                </a>
            </div>
            <div class="sidebar-wrapper" style="background-color: #3c3c3c !important;">
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link" style="color: #fff;" href="/dashboard">
                            <i class="fas fa-user-circle"></i>
                            <p>Mi Usuario</p>
                        </a>
                    </li>
                    {% if usuario.rol == 'Administrador'%}
                    <li class="nav-item">
                      <a class="nav-link" href="/usuarios" style="color: #fff;">
                        <i class="fas fa-users"></i>
                        <p>Usuarios</p>
                      </a>
                    </li>
                    {%endif%}
                    <li class="nav-item">
                        <a class="nav-link" href="/historiasclinicas" style="color: #fff;">
                            <i class="fas fa-notes-medical"></i>
                            <p>Historias Clinicas</p>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/citas" style="background-color: #1e73dc !important;">
                            <i class="fas fa-calendar-alt"></i>
                            <p>Citas</p>
                        </a>
                    </li>
                    {% if usuario.rol == 'Administrador'%}
                        <li class="nav-item">
                        <a class="nav-link" href="/maestros" style="color: #fff;">
                            <i class="fas fa-cogs"></i>
                            <p>Maestros</p>
                        </a>
                        </li>
                    {%endif%}
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top"
                style="background-color: #3c3c3c !important; color: #fff !important;">
                <div class="container-fluid">
                    <div class="navbar-wrapper">
                        <a class="navbar-brand" href="javascript:;">
                            <h6>Copyright Â© 2021 - Medicuentas Plus V 0.1</h6>
                        </a>
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                        <span class="navbar-toggler-icon icon-bar"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="javascript:;">
                                    {{usuario.usuario}}
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/logout">
                                    Cerrar Sesion
                                </a>
                            </li>
                            <!-- your navbar here -->
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                {% if validar == 1%}
                <div id="alerta" class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>El paciente y la cita ha sido agendada satisfactioriamente</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {%endif%}
                <div>
                    <form class="row g-3" method="POST" action="/citas/registrarcita" name="cita" id="cita">
                        {% csrf_token %}
                        <input type="hidden" name="CSRFToken"
                            value="OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZMGYwMGEwOA==">
                        <div>
                            <h1 style="text-align: center; font-size: 45px; color: #1e73dc !important;">AGENDAR CITA</h1>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="validationDefault01" name="nombres"
                                placeholder="Nombres" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="validationDefault02" name="apellidos"
                                placeholder="Apellidos" required>
                        </div>
                        <div class="col-md-4">
                            <label for="validationDefault01" class="form-label">Fecha Nacimiento</label>
                            <input type="date" class="form-control" name="fechanacimiento" id="fechanacimiento" onchange="calcularEdad();" required>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="number" name="edad" id="edad" class="form-control" placeholder="Edad">
                        </div>
                        </div>
                        <div class="col-md-4">
                            <select class="form-control" name="sexo" required>
                              <option selected disabled value="">Seleccionar Sexo</option>
                              <option value="Masculino">Masculino</option>
                              <option value="Femenino">Femenino</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-control" id="tipodoc" name="tipodoc"
                                required>
                                <option selected disabled value="">Seleccionar Tipo Documento</option>
                                {% for tipo in tipodocumento%}
                                <option value="{{tipo}}">{{tipo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="number" name="numerodoc" class="form-control"
                                    id="validationDefaultUsername" aria-describedby="inputGroupPrepend2"
                                    placeholder="Numero Documento" value="{{numerodoc}}" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="number" name="telefono" class="form-control"
                                    id="validationDefaultUsername" aria-describedby="inputGroupPrepend2"
                                    placeholder="Telefono">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="number" name="movil" class="form-control" id="validationDefaultUsername"
                                    aria-describedby="inputGroupPrepend2" placeholder="Movil">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="email" name="correo" class="form-control" id="validationDefaultUsername"
                                    aria-describedby="inputGroupPrepend2" placeholder="Correo" required>
                            </div>
                        </div>
                        {% if usuario.rol == 'Administrador'%}
                            <div class="col-md-4">
                                <select class="form-control" id="selectespe" name="especialidad" onchange="selectespecialidad()"
                                    required>
                                    <option selected disabled value="">Seleccionar Especialidad</option>
                                    {% for espe in especialidad%}
                                    <option value="{{espe.id}}">{{espe.especialidad}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="selectprestador" name="selectprestador"
                                    required disabled>
                                    <option selected disabled>Seleccionar</option>
                                </select>
                            </div>
                        {%endif%}
                            <div class="col-md-4">
                                <div class="input-group">
                                    <textarea type="text" name="actividad" class="form-control" id="validationDefaultUsername"
                                        aria-describedby="inputGroupPrepend2" placeholder="Actividad" required></textarea>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="validationDefault01" class="form-label">Fecha Cita</label>
                                <input type="date" class="form-control" name="fechacita" id="fechacita"  onchange="calcularEdad();" required>
                                <script>
                                    let fechacita = document.getElementById('fechacita');
                                    fechacita.min = new Date().toISOString().split("T")[0];
                                </script>
                            </div>
                            <div class="col-md-4">
                                <label for="validationDefault01" class="form-label">Hora Cita</label>
                                <input type="time" class="form-control" name="horacita" id="horacita"  onchange="calcularEdad();" required>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="clasecita" name="clasecita" 
                                    required>
                                    <option selected disabled value="">Clase De Cita</option>
                                    {% for clase in clasecita%}
                                    <option value="{{clase}}">{{clase}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="entidad" name="entidad"
                                    required>
                                    <option selected disabled value="">Entidad</option>
                                    {% for entid in entidad%}
                                    <option value="{{entid.id}}">{{entid.entidad}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-10">
                                <button class="btn btn-primary" style="background-color: #1e73dc !important;" type="submit">Registrar</button>
                            </div>
                       
                    </form>
                    
                </div>
            </div>
            <!--<footer class="footer">
                <div class="container-fluid">
                    <nav class="float-left">
                        <ul>
                            <li>
                                <a href="https://www.creative-tim.com">
                                    Creative Tim
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="copyright float-right">
                        &copy;
                        <script>
                            document.write(new Date().getFullYear())
                        </script>, made with <i class="material-icons">favorite</i> by
                        <a href="https://www.creative-tim.com" target="_blank">Creative Tim</a> for a better web.
                    </div>
                   your footer here 
                </div>
            </footer>-->
        </div>
    </div>
    {% if validar == 1%}
    <script>
        window.setTimeout(function () {
            // Move to a new location or you can do something else
            window.location.href = "/citas";
        }, 3000);
    </script>
    {%endif%}
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="{% static 'js/jquery-3.6.0.js' %}" type="text/javascript"></script>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js" type="text/javascript"></script>
    <script>
        function selectespecialidad() {
            selectespe = $('#selectespe').val();
            var serviceEndpoint = "{% url 'especialidadseleccionada' %}";
            let anterior = document.getElementById('selectprestador').innerHTML = "";
            $.ajax({
                type: 'POST',
                url: serviceEndpoint,
                data: {
                    selectespe: selectespe
                },
                success: function (data) {
                    let lista = [];
                    lista = data.prestadores;
                    let anterior = document.getElementById('selectprestador');
                    let option = document.createElement('option');
                    anterior.appendChild(option);
                    option.disabled = true;
                    option.innerHTML = "Seleccione el Doctor";
                    $('#selectprestador').prop('disabled', false);
                    lista.forEach(function (datos, index) {
                        console.log(datos.primernombre);
                        let option = document.createElement('option');
                        anterior.appendChild(option);
                        option.value = datos.id;
                        option.id = "selec";
                        option.name = "selectprestador"
                        option.innerHTML += datos.primernombre+" "+datos.primerapellido;
                    });
                }
            });
        }
    </script>
    <script>
        
        function calcularEdad() {
            let fechanacimiento = selectespe = $('#fechanacimiento').val();
            var today = new Date();
            var birthDate = new Date(fechanacimiento);
            var age = today.getFullYear() - birthDate.getFullYear();
            var m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) 
            {
                age--;
            }
            
            document.getElementById("edad").value = age;
        }
    </script>
</body>

</html>